<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
<main >
   

    <h1 style="	color: #333;
    font-size: 24px;
    margin-bottom: 20px;margin-top: 50px; margin-left: 500px;font-family: cursive; text-align: center;">Добавление объявления</h1>


	<form style="  margin-left: 350px;margin-top: 0px;
    background-color: #b3b2b2;
    border: 1px solid #ccc;
    padding: 10px;
    width: 500px;">
    


        <div class="form-group">
            <label for="title">Название товара:</label>
            <input type="text" id="title" name="title" data-val="true" data-required="Введите имя"
                data-pattern="^[А-Яа-яЁё\s]+$" data-error-label="nameErrorLabel">
            <span class="error" id="nameErrorLabel">Ошибка</span>
        </div>


        <div class="form-group">
            <label for="description">Описание товара:</label>
            <textarea id="description" name="description" rows="5" required></textarea>
        </div>


        <div class="form-group">
            <label for="price">Цена:</label>
            <input type="text" id="price" name="price"  data-required="Введите цену"  data-pattern="^\d+(\.\d{1,2})?$" data-positive-number   data-error-label="priceErrorLabel">
            <span class="error" id="priceErrorLabel">Ошибка</span>
        </div>


      
<div class="form-group">
    <label for="phone">Телефон:</label><br>
    <input type="tel" id="phone" name="phone" placeholder="+1-234-567-8901"
        pattern="\+\d-\d{3}-\d{3}-\d{4}" data-val="true" data-required="Введите телефон"
        data-error-label="phoneErrorLabel">
    <span class="error" id="phoneErrorLabel">Ошибка</span>
  </div>
  
  




        <div class="form-group">
            <label for="category">Категория:</label>
		   <select id="category" name="category">
			<option value="electronics">Техника</option>
            <option value="shoes">Обувь</option>
            <option value="cosmetics">Косметика</option>
			<option value="clothing">Одежда</option>
		    <option value="bijouterie">Украшения</option>
           </select>
           <span class="error" id="categoryErrorLabel">Ошибка</span>

        </div>




        <div class="form-group">
            <label for="photo">Фото:</label>
            <input type="file" id="photo" name="photo" accept="image/*" required>
        </div>

        <div class="form-group">
            <input type="submit" value="Добавить">
        </div>
        
   


 
	</form>

    
<div class="listadv" style="text-align: center;">
    <div class="input-panel">
        <button id="show-all-btn" onclick="showAllHandler()">Все</button>
        <button id="show-not-completed-btn" onclick="showNotCompletedHandler()">Не проданые</button>
    </div>
    
    <div class="task-list">
        <p id="start-message">Нет новых товаров</p>
    </div>
    
    <button id="clear-history-btn" onclick="clearHistoryHandler()">Очистить историю</button>

</div>
    

</main>



    <script>
    
   
        const form = document.forms[0];
    
           
            let elements = document.querySelectorAll("[data-val='true']");
    
            elements.forEach(element => {
                element.addEventListener("change", onChangeHandler);
            });
    
            form.addEventListener("submit", onSubmitHandler);
    
            function onChangeHandler(e) {
                const element = e.target;
                if (element.tagName == "INPUT") {
                    validateElement(element);
                }
            }
    
            function onSubmitHandler(e) {
                for (let i = 0; i < form.elements.length; i++) {
                    const element = form.elements[i];
                    let valid = validateElement(element);
                    if (!valid) {
                        e.preventDefault();
                    }
                }
            }
    
            function validateElement(element) {
                for (const key in validators) {
                    if (Object.hasOwnProperty.call(validators, key) && typeof validators[key] == "object") {
    
                        if (element.dataset[key]) {
                            const validator = validators[key];
                            if (!validator.isValid(element))
                                return false;
                        }
                    }
                }
    
                return true;
            }
    
            let validators = {};
    
    
            validators.validate = function (element, message, predicate) {
                let errorLabel = document.querySelector("#" + element.dataset.errorLabel);
                errorLabel.innerHTML = message;
                errorLabel.style.display = "none";
                element.classList.remove("valid");
                element.classList.remove("invalid");
    
                if (typeof predicate == "function" && predicate()) {
                    element.classList.add("valid");
                    return true;
                }
                else {
                    element.classList.add("invalid");
                    errorLabel.style.display = "block";
                    return false;
                }
            };
    
            validators.required = {
                isValid: function (element) {
                    let message = element.dataset.required;
                    return validators.validate(element, message, () => element.value.length > 0);
                }
            };
    
            validators.pattern = {
                isValid: function (element) {
                    let message = "Введенное значение не соответствует шаблону";
                    let regex = new RegExp(element.dataset.pattern);
                    return validators.validate(element, message, () => regex.test(element.value));
                }
            };
    
            validators.confirm = {
                isValid: function (element) {
                    let message = "Значения не совпадают";
                    let confirmInput = document.querySelector("#" + element.dataset.confirm);
                    return validators.validate(element, message, () => element.value == confirmInput.value);
                }
            };
    
    
    
    validators.positiveNumber = {
        isValid: function (element) {
            let message = "Введите положительное число";
            return validators.validate(element, message, () => parseFloat(element.value) > 0);
        }
    };
    
    
    
    
    
    
    
    
            
            
            
            
            
    class Task {
                constructor(title, description, price, phone, category, photo) {
                    this.title = title;
                    this.description = description;
                    this.price = price;
                    this.phone = phone;
                    this.category = category;
                    this.photo = photo;
                    this.isDone = false;
                }
    
                delete() {
    this.isDone = true;
    for (let i = 0; i < dataService.tasks.length; i++) {
        if (dataService.tasks[i] === this) {
            dataService.tasks.splice(i, 1);
            break;
        }
    }
}

            }
    
            let dataService = {
                tasks: [],
    
                get allTasks() {
                    return this.tasks;
                },
    
                get notCompletedTasks() {
                    return this.tasks.filter(task => !task.isDone);
                },
    
                add(task) {
                    this.tasks.push(task);
                    this.save();
                },
    
                save() {
                    localStorage.setItem("tasks", JSON.stringify(this.tasks));
                },
    
                open() {
                    this.tasks = JSON.parse(localStorage.getItem("tasks")) || [];
                }
            
            }
    
            class TasksListView {
                element;
    
                constructor(element) {
                    this.element = element;
                }
    
                #drawList(tasksElements) {
                    this.element.innerHTML = "";
    
                    tasksElements.forEach(taskElement => {
                        if (!taskElement.task.isDone) {
                            taskElement.createIn(this.element);
                        }
                    });
                }
    
                drawAll() {
                    let taskElements = [];
                    let tasks = dataService.allTasks;
                    if (tasks.length === 0) return;
    
                    tasks.forEach(task => {
                        taskElements.push(new TaskView(task))
                    });
                    this.#drawList(taskElements);
                }
    
    
               
    
                drawNotCompleted() {
                    let taskElements = [];
                    let tasks = dataService.notCompletedTasks;
                    if (tasks.length === 0) return;
    
                    tasks.forEach(task => {
                        taskElements.push(new TaskView(task))
                    });
                    this.#drawList(taskElements);
                }
            }
    
            class TaskView {
                constructor(task) {
                    this.task = task;
                    this.div = null;
                }
    
                createIn(element) {
                    this.div = document.createElement("div");
                    this.div.classList.add("task");
    
                    let p = document.createElement("p");
                    p.innerHTML = `<strong>${this.task.title}</strong><br>
                                    Описание: ${this.task.description}<br>
                                    Цена: ${this.task.price}<br>
                                    Телефон: ${this.task.phone}<br>
                                    Категория: ${this.task.category}<br>
                                    <img src="${this.task.photo}" alt="Advertisement Photo" style="max-width: 100px; max-height: 100px;">`;
    
                    this.div.append(p);
                    
      
    
                    let deleteButton = document.createElement("button");
        deleteButton.textContent = "Удалить";
        deleteButton.addEventListener("click", () => deleteTaskHandler(this.task));
        this.div.appendChild(deleteButton);

                    element.append(this.div);
                }
            }
    
            let taskNameInput = document.querySelector("#title");
            let priceInput=document.querySelector("#price");
            let phoneInput= document.querySelector("#phone");
            
            let addTaskButton = document.querySelector("input[type='submit']");
            let startMessage = document.querySelector("#start-message");
            let showAllButton = document.querySelector("#show-all-btn");
            let showNotCompletedButton = document.querySelector("#show-not-completed-btn");
            let taskList = document.querySelector(".task-list");
    
            dataService.open();
            let tasksListView = new TasksListView(taskList);
    
            addTaskButton.addEventListener("click", addTaskHandler);
            showAllButton.addEventListener("click", showAllHandler);
            showNotCompletedButton.addEventListener("click", showNotCompletedHandler);
    
            window.addEventListener("load", function () {
                tasksListView.drawAll();
            });
    
            taskNameInput.addEventListener("keydown", function (e) {
                if (e.code == "Enter") addTaskHandler();
            })
        
            priceInput.addEventListener("keydown", function (e) {
                if (e.code == "Enter") addTaskHandler();
            })
            phoneInput.addEventListener("keydown", function (e) {
                if (e.code == "Enter") addTaskHandler();
            })
    
            function addTaskHandler() {
        if (!startMessage.hidden) startMessage.hidden = true;
    
        // Валидация всех полей
        const isValidTitle = validateElement(taskNameInput);
        const isValidDescription = validateElement(document.querySelector("#description"));
        const isValidPrice = validateElement(priceInput);
        const isValidPhone = validateElement(phoneInput);
        const isValidCategory = validateElement(document.querySelector("#category"));
        const isValidPhoto = validateElement(document.querySelector("#photo"));
    
        // Проверка успешности валидации всех полей
        if (isValidTitle && isValidDescription && isValidPrice && isValidPhone && isValidCategory && isValidPhoto) {
            let newTask = new Task(
                taskNameInput.value,
                document.querySelector("#description").value,
                priceInput.value,
                phoneInput.value,
                 document.querySelector("#category").value,
                document.querySelector("#photo").value
            );
    
            dataService.add(newTask);
            tasksListView.drawAll();
    
            let taskList = document.querySelector(".task-list");
            taskList.innerHTML = "";
    
            
    let taskView = new TaskView(newTask);
    taskView.createIn(taskList);

    
    let deleteButton = document.createElement("button");
    deleteButton.textContent = "Удалить";
    deleteButton.addEventListener("click", function () {
        deleteTaskHandler(taskView.task);
    });
    taskView.div.appendChild(deleteButton);

    
    taskNameInput.value = "";

        } else {
           
            alert("Форма содержит ошибки. Пожалуйста, проверьте все поля.");
        }
    }
    
  
    
            function showAllHandler() {
                tasksListView.drawAll();
            }
    
            function showNotCompletedHandler() {
                tasksListView.drawNotCompleted();
            }
    
          function deleteTaskHandler(task) {
    task.delete();
    dataService.save();
    tasksListView.drawAll();
}

    
            function clearHistoryHandler() {
                if (confirm("Вы уверены, что хотите очистить историю?")) {
                    dataService.tasks = [];
                    dataService.save();
                    tasksListView.drawAll();
                    alert("История успешно очищена.");
                }
            }
    
           
           
    
    
    
    
    
     </script>
</body>
</html>